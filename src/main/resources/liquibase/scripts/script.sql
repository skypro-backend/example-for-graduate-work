-- liquibase formatted sql
-- changeset margo:1

CREATE TABLE user_entity
(
  pk int4 generated by default as identity,
  email varchar(32) NOT NULL,
  first_name varchar(16) NOT NULL,
  last_name varchar(16) NOT NULL,
  phone varchar(12) NOT NULL,
  role varchar(6) NOT NULL,
  image_entity_id int4 NULL,
  password varchar(60) NOT NULL,
  primary key (pk)
);

CREATE TABLE comment_entity
(
  pk int4 generated by default as identity,
  author_id int4 NOT NULL,
  ad_id int4 NOT NULL,
  created_at timestamp NOT NULL,
  text varchar(64) NOT NULL,
  primary key (pk)
);

CREATE TABLE ad_entity
(
  pk int4 generated by default as identity,
  author_id int4 NOT NULL,
  image_entity_id int4 NOT NULL,
  price int4 NOT NULL,
  title varchar(32) NOT NULL,
  description varchar(64) NOT NULL,
  primary key (pk)
);

CREATE TABLE image_entity
(
    id int4 generated by default as identity,
    file_path text,
    primary key (id)
);

alter table ad_entity add constraint fk_ad_to_user FOREIGN KEY (author_id) references user_entity;
alter table ad_entity add constraint fk_ad_to_image FOREIGN KEY (image_entity_id) references image_entity;

alter table comment_entity add constraint fk_comment_to_user FOREIGN KEY (author_id) references user_entity;
alter table comment_entity add constraint fk_comment_to_ad FOREIGN KEY (ad_id) references ad_entity;

alter table user_entity add constraint fk_user_to_image FOREIGN KEY (image_entity_id) references image_entity;